version: "3.8"

services:
  backend:
    build:
      context: .
      dockerfile: server/Dockerfile
    image: packchann-backend:latest
    container_name: packchann_backend
    ports:
      - "8088:8088"
    restart: unless-stopped
    volumes:
      # 将本地配置挂载到容器，方便在开发/部署时通过修改 config.toml 控制数据库等
      - ./server/config:/app/config:ro
    environment:
      - GIN_MODE=release
      - CONFIG_PATH=/app/config/config.toml
    networks:
      - appnet

  frontend:
    build:
      context: .
      dockerfile: web/Dockerfile
    image: packchann-frontend:latest
    container_name: packchann_frontend
    ports:
      - "80:80"
    restart: unless-stopped
    volumes:
      # 如果你有运行时需要的前端环境文件，可以挂载到静态目录（注意：前端通常在构建时读取 env）
      - ./web/.env:/usr/share/nginx/html/.env:ro
    depends_on:
      - backend
    networks:
      - appnet

networks:
  appnet:
    driver: bridge

